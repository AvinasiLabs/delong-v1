# DeLong Protocol Subgraph - Example Queries

# ========== Dataset Queries ==========

# Get all datasets with basic info
query GetAllDatasets {
  datasets(
    first: 20
    orderBy: createdAt
    orderDirection: desc
  ) {
    id
    datasetId
    name
    symbol
    metadataURI
    projectAddress
    rentalPricePerHour
    totalRentalRevenue
    totalRentalAccesses
    totalPurchases
    totalSales
    createdAt
    ido {
      status
      currentPrice
      totalRaised
    }
  }
}

# Get single dataset with full details
query GetDatasetDetails($datasetId: ID!) {
  dataset(id: $datasetId) {
    id
    datasetId
    name
    symbol
    metadataURI
    projectAddress
    rentalPricePerHour

    # IDO info
    ido {
      id
      status
      salableTokens
      tokensSold
      totalRaised
      currentPrice
      initialPrice
      startTime
      endTime
      launchedAt
      failedAt
    }

    # Token info
    token {
      id
      totalSupply
      holdersCount
      isFrozen
      unfrozenAt
    }

    # Aggregated stats
    totalPurchases
    totalSales
    totalRentalRevenue
    totalRentalAccesses

    # Recent purchases (last 10)
    purchases(first: 10, orderBy: timestamp, orderDirection: desc) {
      id
      buyer {
        id
      }
      tokenAmount
      usdcAmount
      pricePerToken
      timestamp
    }

    # Recent rentals (last 10)
    rentals(first: 10, orderBy: timestamp, orderDirection: desc) {
      id
      user {
        id
      }
      hours
      totalCost
      timestamp
    }
  }
}

# Search datasets by name/symbol
query SearchDatasets($search: String!) {
  datasets(
    where: {
      or: [
        { name_contains_nocase: $search }
        { symbol_contains_nocase: $search }
      ]
    }
    first: 10
  ) {
    id
    name
    symbol
    projectAddress
    totalRentalRevenue
    ido {
      status
      currentPrice
    }
  }
}

# Get trending datasets (by rental revenue)
query GetTrendingDatasets {
  datasets(
    first: 10
    orderBy: totalRentalRevenue
    orderDirection: desc
    where: {
      totalRentalRevenue_gt: "0"
    }
  ) {
    id
    name
    symbol
    totalRentalRevenue
    totalRentalAccesses
    rentalPricePerHour
    ido {
      status
      currentPrice
    }
  }
}

# ========== IDO Queries ==========

# Get active IDOs
query GetActiveIDOs {
  idOs(
    where: {
      status: "Active"
    }
    orderBy: startTime
    orderDirection: desc
  ) {
    id
    dataset {
      id
      name
      symbol
      projectAddress
    }
    status
    tokensSold
    totalRaised
    currentPrice
    initialPrice
    startTime
    endTime
    salableTokens
    targetTokens
  }
}

# Get IDO with trading history
query GetIDODetails($idoAddress: ID!) {
  ido(id: $idoAddress) {
    id
    dataset {
      id
      name
      symbol
      metadataURI
    }
    status
    salableTokens
    projectTokens
    targetTokens
    tokensSold
    totalRaised
    initialPrice
    currentPrice
    startTime
    endTime
    launchedAt
    failedAt

    # Recent purchases
    purchases(first: 20, orderBy: timestamp, orderDirection: desc) {
      id
      buyer {
        id
      }
      tokenAmount
      usdcAmount
      pricePerToken
      protocolFee
      timestamp
      transactionHash
    }

    # Recent sales
    sales(first: 20, orderBy: timestamp, orderDirection: desc) {
      id
      seller {
        id
      }
      tokenAmount
      usdcAmount
      pricePerToken
      protocolFee
      timestamp
      transactionHash
    }
  }
}

# ========== User Queries ==========

# Get user profile and activity
query GetUserProfile($userAddress: ID!) {
  user(id: $userAddress) {
    id
    totalPurchases
    totalSales
    totalRentalSpent
    totalDividendsClaimed

    # Token holdings
    tokenHoldings(
      where: {
        balance_gt: "0"
      }
    ) {
      token {
        id
        dataset {
          name
          symbol
        }
      }
      balance
      pendingDividends
      firstAcquiredAt
    }

    # Purchase history
    purchases(first: 20, orderBy: timestamp, orderDirection: desc) {
      id
      dataset {
        id
        name
        symbol
      }
      tokenAmount
      usdcAmount
      pricePerToken
      timestamp
      transactionHash
    }

    # Rental history
    rentals(first: 20, orderBy: timestamp, orderDirection: desc) {
      id
      dataset {
        id
        name
        symbol
      }
      hours
      totalCost
      timestamp
      transactionHash
    }

    # Dividend claims
    dividendClaims(first: 20, orderBy: timestamp, orderDirection: desc) {
      id
      pool {
        dataset {
          name
        }
      }
      amount
      timestamp
      transactionHash
    }
  }
}

# Get user's token holdings
query GetUserHoldings($userAddress: ID!) {
  tokenHolders(
    where: {
      user: $userAddress
      balance_gt: "0"
    }
  ) {
    id
    token {
      id
      dataset {
        id
        name
        symbol
        rentalPricePerHour
      }
      totalSupply
    }
    balance
    pendingDividends
    revenueDebt
    firstAcquiredAt
  }
}

# ========== Trading Activity Queries ==========

# Get recent trades (both buys and sells)
query GetRecentTrades {
  tokenPurchases(first: 10, orderBy: timestamp, orderDirection: desc) {
    id
    dataset {
      name
      symbol
    }
    buyer {
      id
    }
    tokenAmount
    usdcAmount
    pricePerToken
    timestamp
    transactionHash
  }

  tokenSales(first: 10, orderBy: timestamp, orderDirection: desc) {
    id
    dataset {
      name
      symbol
    }
    seller {
      id
    }
    tokenAmount
    usdcAmount
    pricePerToken
    timestamp
    transactionHash
  }
}

# Get trades for specific dataset
query GetDatasetTrades($datasetId: ID!) {
  dataset(id: $datasetId) {
    purchases(first: 50, orderBy: timestamp, orderDirection: desc) {
      id
      buyer {
        id
      }
      tokenAmount
      usdcAmount
      pricePerToken
      protocolFee
      timestamp
      transactionHash
    }
    sales(first: 50, orderBy: timestamp, orderDirection: desc) {
      id
      seller {
        id
      }
      tokenAmount
      usdcAmount
      pricePerToken
      protocolFee
      timestamp
      transactionHash
    }
  }
}

# ========== Rental Queries ==========

# Get recent rental accesses
query GetRecentRentals {
  rentalAccesses(
    first: 20
    orderBy: timestamp
    orderDirection: desc
  ) {
    id
    dataset {
      id
      name
      symbol
    }
    user {
      id
    }
    hours
    totalCost
    protocolFee
    dividendAmount
    timestamp
    transactionHash
  }
}

# Get rentals for specific dataset
query GetDatasetRentals($datasetId: ID!) {
  dataset(id: $datasetId) {
    rentals(first: 50, orderBy: timestamp, orderDirection: desc) {
      id
      user {
        id
      }
      hours
      totalCost
      timestamp
      transactionHash
    }

    usageRecords(first: 50, orderBy: timestamp, orderDirection: desc) {
      id
      user {
        id
      }
      duration
      timestamp
    }
  }
}

# ========== Dividend Queries ==========

# Get rental pool dividends info
query GetPoolDividends($poolAddress: ID!) {
  rentalPool(id: $poolAddress) {
    id
    dataset {
      id
      name
      symbol
    }
    accRevenuePerToken
    totalDividendsClaimed

    dividendClaims(first: 50, orderBy: timestamp, orderDirection: desc) {
      id
      user {
        id
      }
      amount
      timestamp
      transactionHash
    }
  }
}

# Get user's pending dividends across all datasets
query GetUserPendingDividends($userAddress: ID!) {
  tokenHolders(
    where: {
      user: $userAddress
      balance_gt: "0"
      pendingDividends_gt: "0"
    }
  ) {
    token {
      dataset {
        id
        name
        symbol
      }
    }
    balance
    pendingDividends
  }
}

# ========== DAO Governance Queries ==========

# Get all treasury proposals
query GetTreasuryProposals {
  treasuryProposals(
    first: 20
    orderBy: submittedAt
    orderDirection: desc
  ) {
    id
    proposalId
    proposer
    recipient
    amount
    description
    status
    submittedAt
    approvedAt
    executedAt
    cancelledAt
  }
}

# Get governance proposals
query GetGovernanceProposals {
  governanceProposals(
    first: 20
    orderBy: createdAt
    orderDirection: desc
  ) {
    id
    proposalId
    proposer {
      id
    }
    proposalType
    datasetToken
    targetAddress
    newPrice
    status
    votesFor
    votesAgainst
    totalVotes
    createdAt
    executedAt

    votes(first: 10, orderBy: timestamp, orderDirection: desc) {
      voter {
        id
      }
      support
      votes
      timestamp
    }
  }
}

# Get active governance proposals
query GetActiveProposals {
  governanceProposals(
    where: {
      status: "Active"
    }
    orderBy: createdAt
    orderDirection: desc
  ) {
    id
    proposalId
    proposer {
      id
    }
    proposalType
    datasetToken
    votesFor
    votesAgainst
    totalVotes
    createdAt
  }
}

# ========== Protocol Stats ==========

# Get global protocol statistics
query GetProtocolStats {
  protocolStats(id: "1") {
    totalDatasets
    activeDatasets
    activeIDOs
    launchedIDOs
    failedIDOs
    totalTradingVolume
    totalProtocolFees
    totalRentalRevenue
    totalRentalAccesses
    totalUsers
    lastUpdated
  }
}

# ========== LP Lock Queries ==========

# Get LP lock information for dataset
query GetLPLock($datasetTokenAddress: ID!) {
  lpLock(id: $datasetTokenAddress) {
    id
    dataset {
      id
      name
      symbol
    }
    lpTokenAmount
    lpTokenValue
    projectAddress
    lockedAt
    accumulatedRevenue
    withdrawnAmount

    withdrawals(orderBy: timestamp, orderDirection: desc) {
      id
      amount
      accumulatedRevenue
      timestamp
      transactionHash
    }
  }
}

# Get all LP locks ordered by accumulated revenue
query GetTopLPLocks {
  lpLocks(
    first: 20
    orderBy: accumulatedRevenue
    orderDirection: desc
  ) {
    id
    dataset {
      name
      symbol
    }
    lpTokenAmount
    lpTokenValue
    accumulatedRevenue
    withdrawnAmount
    lockedAt
  }
}
