specVersion: 0.0.5
schema:
  file: ./schema.graphql
dataSources:
  # Factory Contract - Entry point for dataset creation
  - kind: ethereum
    name: Factory
    network: sepolia
    source:
      address: "0xe78313C3ea55886083ba849CeE446B6CE5395f98"
      abi: Factory
      startBlock: 7100000 # Sepolia deployment block (approximate)
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - Dataset
      abis:
        - name: Factory
          file: ./abis/Factory.json
      eventHandlers:
        - event: DatasetDeployed(indexed uint256,indexed address,address,address,address,address)
          handler: handleDatasetDeployed
      file: ./src/mapping.ts

  # RentalManager Contract - Handles all rental operations
  - kind: ethereum
    name: RentalManager
    network: sepolia
    source:
      address: "0x393200F05F2041466d6f78b54535033E1bA4A87e"
      abi: RentalManager
      startBlock: 7100000 # Sepolia deployment block (approximate)
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - AccessPurchasedEvent
        - UsageRecordedEvent
        - RentalDistributedEvent
        - RevenueAccumulatedEvent
        - LPLockedEvent
        - LPWithdrawnEvent
      abis:
        - name: RentalManager
          file: ./abis/RentalManager.json
      eventHandlers:
        - event: AccessPurchased(indexed address,indexed address,uint256,uint256)
          handler: handleAccessPurchased
        - event: UsageRecorded(indexed address,indexed address,indexed uint256,uint256,uint256)
          handler: handleUsageRecorded
        - event: RentalDistributed(indexed address,uint256,uint256,uint256)
          handler: handleRentalDistributed
        - event: RevenueAccumulated(indexed address,uint256,uint256)
          handler: handleRevenueAccumulated
        - event: LPLocked(indexed address,indexed address,indexed address,uint256,uint256)
          handler: handleLPLocked
        - event: LPWithdrawn(indexed address,uint256,uint256)
          handler: handleLPWithdrawn
      file: ./src/mapping.ts

  # DAOTreasury Contract
  - kind: ethereum
    name: DAOTreasury
    network: sepolia
    source:
      address: "0x7E4Cc6881005dc0Ef6a42c2737517cc55caADf35"
      abi: DAOTreasury
      startBlock: 7100000 # Sepolia deployment block (approximate)
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - TreasuryProposalSubmittedEvent
        - TreasuryProposalStatusEvent
      abis:
        - name: DAOTreasury
          file: ./abis/DAOTreasury.json
      eventHandlers:
        - event: ProposalSubmitted(indexed uint256,indexed address,indexed address,uint256,string)
          handler: handleProposalSubmitted
        - event: ProposalApproved(indexed uint256,uint256)
          handler: handleProposalApproved
        - event: ProposalRejected(indexed uint256,uint256)
          handler: handleProposalRejected
        - event: ProposalExecuted(indexed uint256,uint256,uint256)
          handler: handleProposalExecuted
        - event: ProposalCancelled(indexed uint256,uint256)
          handler: handleProposalCancelled
      file: ./src/mapping.ts

  # DAOGovernance Contract
  - kind: ethereum
    name: DAOGovernance
    network: sepolia
    source:
      address: "0xA7cBDC71A74080c79825c83fEEEF65dEE0366F43"
      abi: DAOGovernance
      startBlock: 7100000 # Sepolia deployment block (approximate)
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - GovernanceProposalCreatedEvent
        - VoteCastEvent
        - GovernanceProposalStatusEvent
      abis:
        - name: DAOGovernance
          file: ./abis/DAOGovernance.json
      eventHandlers:
        - event: ProposalCreated(indexed uint256,indexed address,uint8,address,string,uint256)
          handler: handleProposalCreated
        - event: VoteCast(indexed uint256,indexed address,uint8,uint256)
          handler: handleVoteCast
        - event: ProposalExecuted(indexed uint256,uint256)
          handler: handleGovernanceProposalExecuted
        - event: ProposalCancelled(indexed uint256,uint256)
          handler: handleGovernanceProposalCancelled
      file: ./src/mapping.ts

# Template for dynamically created contracts
templates:
  - kind: ethereum/contract
    name: IDO
    network: sepolia
    source:
      abi: IDO
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - TokenPurchaseEvent
        - TokenSaleEvent
        - IDOLaunchedEvent
        - IDOFailedEvent
        - RefundClaimedEvent
        - IDOState
      abis:
        - name: IDO
          file: ./abis/IDO.json
      eventHandlers:
        - event: TokensPurchased(indexed address,uint256,uint256,uint256,uint256,uint256)
          handler: handleTokensPurchased
        - event: TokensSold(indexed address,uint256,uint256,uint256,uint256,uint256)
          handler: handleTokensSold
        - event: IDOLaunched(uint256,uint256,uint256,uint256,uint256,uint256)
          handler: handleIDOLaunched
        - event: IDOFailed(uint256,uint256,uint256,uint256)
          handler: handleIDOFailed
        - event: RefundClaimed(indexed address,uint256,uint256,uint256)
          handler: handleRefundClaimed
      file: ./src/mapping.ts

  - kind: ethereum/contract
    name: DatasetToken
    network: sepolia
    source:
      abi: DatasetToken
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - TokenTransferEvent
        - TokenUnfrozenEvent
      abis:
        - name: DatasetToken
          file: ./abis/DatasetToken.json
      eventHandlers:
        - event: Transfer(indexed address,indexed address,uint256)
          handler: handleTransfer
        - event: Unfrozen(uint256)
          handler: handleUnfrozen
      file: ./src/mapping.ts

  - kind: ethereum/contract
    name: DatasetManager
    network: sepolia
    source:
      abi: DatasetManager
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - MetadataUpdatedEvent
        - TrialUsageRecordedEvent
        - DatasetStatusUpdatedEvent
      abis:
        - name: DatasetManager
          file: ./abis/DatasetManager.json
      eventHandlers:
        - event: MetadataUpdated(string,string,uint256,uint256)
          handler: handleMetadataUpdated
        - event: TrialUsageRecorded(indexed address,uint256,uint256)
          handler: handleTrialUsageRecorded
        - event: StatusUpdated(uint8,uint8,uint256)
          handler: handleStatusUpdated
      file: ./src/mapping.ts

  - kind: ethereum/contract
    name: RentalPool
    network: sepolia
    source:
      abi: RentalPool
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - RevenueAddedEvent
        - DividendClaimedEvent
      abis:
        - name: RentalPool
          file: ./abis/RentalPool.json
      eventHandlers:
        - event: RevenueAdded(uint256,uint256)
          handler: handleRevenueAdded
        - event: DividendsClaimed(indexed address,uint256)
          handler: handleDividendsClaimed
      file: ./src/mapping.ts
